stages:
  - test

run_tests:
  stage: test
  image: docker/compose:1.29.2
  services:
    - docker:dind
  variables:
    DOCKER_HOST: tcp://docker:2375/
    DOCKER_TLS_CERTDIR: ""
  before_script:
    - apk add --no-cache py3-pip
    - pip install docker-compose
  script:
    - docker-compose up -d --build
    - docker-compose exec -T web python manage.py test
    - docker-compose down
